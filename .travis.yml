before_install:
  - eval "${MATRIX_EVAL}"
  - sudo add-apt-repository ppa:ricotz/testing -y
  - sudo add-apt-repository ppa:aacid/openjp2trusty -y
  - sudo apt-get -qq update
  - sudo apt-get install -y libopenjp2-7-dev qtbase5-dev gobject-introspection libglib2.0-dev libgtk-3-dev libgirepository1.0-dev libnss3-dev
  - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.9 20
  - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.9 20
  - sudo update-alternatives --install /usr/bin/gcov gcov /usr/bin/gcov-4.9 20
  - git clone git://git.freedesktop.org/git/poppler/test test-files

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - gcc-4.9
      - g++-4.9

language: cpp

compiler:
 - clang
 - gcc

script: cmake . -DTESTDATADIR=`pwd`/test-files && make -j2 && make test
